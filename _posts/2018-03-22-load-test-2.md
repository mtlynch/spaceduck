---
title: 'Sia Load Test Result 2: Real Data Scenario'
layout: post
date: '2018-03-15'
summary: Testing Sia's performance on real world data
tags:
- sia
- load test
permalink: "/load-test-2/"
og_image: "/images/2018-03-15-load-test-1/renter-spending.png"
comments: true
---

Last month, I [announced](/sia-load-test-preview/) the first ever load test of Sia. The load test consists of three distinct test cases:

1. [Worst-case scenario](/load-test-1) (published 2018-03-15)
2. Real data scenario (this report)
3. Best-case scenario

## Results summary

| Metric | Value |
|---------|---------|
| Total uploaded | XX.X TiB (file bytes)<br />YY.Y TiB (absolute bytes) |
| Storage efficiency | XX.X% |
| Total files uploaded | XX |
| Total file contracts created | XX |
| Total spent | XX SC<br />$YY.Y\* USD |
| $ per TB/month | $X |
| Total test time | XX.X hours (YY.Y days) |
| Average upload bandwidth | XX.XMbps (file data)<br />YY.Y Mbps (absolute) |
| Final contract count | XX |
| Sia crashes | 0 |
| Sia version | 1.3.1 |
| Test OS | Win10 x64 |

\* Using the 2018-03-11 price of 1.4 cents per SC. Assumes that unused renter funds will successfully return to the test wallet at the conclusion of the renter contracts.

## File bytes vs. absolute bytes

*(feel free to skip this if you read this in the [previous report](/load-test-1))*

On traditional cloud storage providers like Amazon S3 or Google Cloud Storage, there is a 1:1 ratio between the size of your files and the amount of data for which you are billed. If you upload 100 GiB of files, you pay for 100 GiB of upload bandwidth and for 100 GiB of storage space.

Sia's costs are more complicated. If you upload 100 GiB of files, the best you can hope for is to pay for 300 GiB in bandwidth and storage (due to Sia's 3x replication). In practice, the cost is not easily predictable, as it depends on how efficiently Sia repackages your files and how reliable your hosts are.

To keep the semantics clear, I introduce two terms for distinguishing between these metrics:

**File bytes** is the total number of bytes in files uploaded to Sia.

**Absolute bytes** is the total amount of data uploaded to hosts, including Sia metadata, file padding, and redundant copies of the data.

If you upload a 100 GiB file and it causes to Sia upload 350 GiB to hosts, that represents a 100 GiB increase in file bytes and a 350 GiB increase in absolute bytes.

## File data bandwidth vs. absolute bandwidth

*(feel free to skip this if you read this in the [previous report](/load-test-1))*

Because of the distinction between file bytes and absolute bytes, a similar disambiguation is required for bandwidth. In this report, I distinguish between file data bandwidth and absolute bandwidth.

The simplest way to explain them is through an example:

1. User uploads a 500 MB file to Sia.
1. Sia breaks this file into 12 equally-sized chunks of ~42 MB each, totaling ~504 MB.
1. Sia uploads each chunk to three different hosts.
1. All uploads complete after 40 seconds.

The file data bandwidth is simply the size of the file divided by the upload duration:

```
= 500 MB / 40 seconds
= 4000 Mb / 40 seconds
= 100 Mbps
```

The absolute bandwidth is the total amount of data transferred divided by the upload duration:

```
= ((42 MB * 12 chunks) * 3 hosts) / 40 seconds
= ((504 MB) * 3 hosts) / 40 seconds
= 1512 MB / 40 seconds
= 12096 Mb / 40 seconds
= 302.4 Mbps
```

## File data bandwidth is what matters

If you have 50 TiB of data to upload to Sia, and you want to know how long this will take, that's the file data bandwidth.

The absolute data bandwidth is useful to guide Sia developers in designing their upload algorithms, but it is not directly relevant to users.

In this report, I focus on file data bandwidth.

## Input data

For this test, I used real data. I still buy Blu-rays and DVDs. Whenever I buy one, I rip it to a raw ISO image. Then I use Handbrake to convert it to mp4s for streaming. I have 4.4 TiB of files total.

This is a realistic test of Sia because I am interested in backing up these files, but even on a low-cost backup solution like AWS Glacier, this would cost about $20/mo, which may not sound so bad until you consider that if I ever needed to recover from a backup, the cost for bandwidth and data retrieval would be about $450.

If I could store this data on Sia for <$10/mo and recover it for <$50 in bandwidth, I'd strongly consider using. This won't be possible in practice until Sia supports data recovery, but I can begin estimating costs now.


| Statistic | Value |
|---|---|
| Minimum file size | 886 bytes |
| Maximum file size | 46.3 GiB |
| Median file size | 343.2 MiB |
| Mean file size | 1.7 GiB |
| Variance | 12.2 GiB |

There were 10 small metadata files (`Thumbs.db` and such) that slipped in, but the files were otherwise well above Sia's  40 MiB chunk size.

{% include image.html file="file-size-histogram.png" alt="File size histogram" fig_caption="Sia 1.3.1 Load Test&#58; Real data - File size histogram" img_link="true" %}

## Storage efficiency

To measure how well Sia stores data, I created the metric of "storage efficiency," which is simply the file bytes divided by the absolute bytes.

On traditional cloud storage providers, efficiency is 100% because you pay for exactly the size of your files. On Sia, the best possible efficiency is 33.3% because Sia uploads every byte of file data at least three times for redundancy. Other factors can degrade efficiency, such as inefficient repackaging of files or unreliable hosts.


## Cost

## Upload bandwidth

The test uploaded XX.X TiB of file data in YY.Y hours. That's equivalent to an upload bandwidth of ZZ.Z Mbps.

## API latency

All the metrics shown in this report come from three Sia daemon APIs that [sia_metrics_collector](https://github.com/mtlynch/sia_metrics_collector) polls:

* `/renter/contracts`
* `/renter/files`
* `/wallet`

The API latency is the total amount of time required to call these three APIs in sequence:


## Raw data

* Logs (TODO: link)
* [Metrics](https://docs.google.com/spreadsheets/d/1HJ1c2bFonXPhVdvrovM-MenZQ16VIfqOqPrnrDZGRbc/edit?usp=sharing)

## Test notes

* The load test script crashed at 2018-03-12 03:17:48Z (at the 7.23 hours elapsed mark). It was down for approximately 40 minutes. During this time, upload bandwidth drops to zero, but this is due to testing error rather than Sia underperformance. All other bandwidth measurements in the test are accurate measures of Sia's performance.

## Reproducing results

All steps to reproduce these results are available in the [sia_load_tester](https://github.com/mtlynch/sia_load_tester/blob/2802acc77d6651bec88cf954c5240197bc6d9627/README.md) README.