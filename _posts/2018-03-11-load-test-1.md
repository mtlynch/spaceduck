---
title: 'Load Test Result 1: Maximum Files'
layout: post
date: '2018-03-11'
summary: How many files can Sia handle?
tags:
- sia
- load test
permalink: "/load-test-1/"
comments: true
---

Last month, I [announced](/sia-load-test-preview/) the first ever load test of Sia. I have the results of the first test case: maximum files.

This test case is meant to capture the lower-bound of Sia's performance. It measures Sia's performance as it uploads thousands of 1-byte files. Because Sia splits files into ~40 MiB chunks, each 1-byte file requires ~40 MiB of overhead, so these 1-byte files will be the ones that Sia performs worst on.

## Summary

| Metric | Value |
|---------|---------|
| Total Data Uploaded | - |
| Total Files Uploaded | - |
| Total File Contracts Created | - |
| Total Spent | - |
| Cost per TB | -\* |
| Total test time | XX hours (YY.Y days) |
| Average upload bandwidth | XX.X Mbps file data / YY.Y Mbps including Sia overhead |
| Final contract count | - |
| Sia crashes | 0 |

\* Cost per TB is ludicrously high because this particular test case optimizes for high file count at the expense of efficient storage.

## Highlights



## Upload bandwidth

Of all the results so far, I was most surprised by upload bandwidth. The test uploaded XX.X Mbps of file data in YY.Y hours. That's equivalent to an upload bandwidth of 1.8 x 10<sup>-7</sup> Mbps.

That result doesn't mean much because this test case is designed to use Sia inefficiently. The more meaningful result is the total number of bytes uploaded, which was XX.X TiB. If I assume the total uploaded bytes would be the same with optimal file sizes (minimizing Sia overhead), Sia still uploads file data at 3x redundancy, meaning that the most file data Sia could upload with XX.X TiB of total uploaded bytes would be ~ YY.Y TiB. At this rate, uploading 10 TiB of data would take about 3 months.

I'll have a better understanding of Sia's effective upload bandwidth on real data in the next test case, but so far, I expect this will be the biggest obstacle for enterprise adoption.

## Cost



## API latency

## Sia bugs observed

## Flaws in test design

Having run this test, I now realize I made some big mistakes in designing the test parameters. I expected Sia to either reach 10 TB of upload or completely die in a few days.

For the sake of consistency, I'm going to run the remaining two scenarios of the load test under the same parameters, but I will terminate each test case after seven days of data collection.

### Unrealistic bandwidth minimum

The test plan required that the Sia would continue as long as Sia continued to make forward progress, where "forward progress" is defined as at least 3 Mbps of upload, averaged over the past hour. This is far too low a threshold. At this rate, it would take over nine days to upload a 100 GB file through Sia.

**Proposed fix**: Set the bandwidth requirement to the minimum required to satisfy Sia's target user. For example, a business customer would likely need to upload about 1 TB or data per day

### Parallelism

When I assumed that each test case would take a day or two, designing it to run on my home machine wasn't a big deal. Now that I've discovered how long the test can run, I realize I should have put more effort into designing it to run on cloud VMs.

**Proposed fix**: Modify 

## Reproducing Results

All steps to reproduce these results are available in the [sia_load_tester](https://github.com/mtlynch/sia_load_tester/tree/be8229c0722bf2cd4386ada32bf1b77c111d7101) README.